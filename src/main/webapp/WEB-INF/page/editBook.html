<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="description" content="Xenon Boostrap Admin Panel" />
	<meta name="author" content="" />

	<title>编辑家庭图书</title>

	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Arimo:400,700,400italic">
	<link rel="stylesheet" href="../static/asset/css/fonts/linecons/css/linecons.css">
	<link rel="stylesheet" href="../static/asset/css/fonts/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="../static/asset/css/bootstrap.css">
	<link rel="stylesheet" href="../static/asset/css/xenon-core.css">
	<link rel="stylesheet" href="../static/asset/css/xenon-forms.css">
	<link rel="stylesheet" href="../static/asset/css/xenon-components.css">
	<link rel="stylesheet" href="../static/asset/css/xenon-skins.css">
	<link rel="stylesheet" href="../static/asset/css/custom.css">
	<!-- Imported styles on this page -->
	<link rel="stylesheet" href="../static/asset/js/select2/select2.css">
	<link rel="stylesheet" href="../static/asset/js/select2/select2-bootstrap.css">
	<link rel="stylesheet" href="../static/asset/js/multiselect/css/multi-select.css">
	<link rel="stylesheet" href="../static/css/style.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->


</head>
<body class="page-body">
	<div class="page-container">
		<!-- 左侧菜单 -->
		<div class="sidebar-menu toggle-others fixed">
			<div class="sidebar-menu-inner">
				<header class="logo-env">
		
					<!-- logo -->
					<div class="logo">
						<a href="dashboard-1.html" class="logo-expanded">
							家庭图书管理系统
						</a>
		
						<a href="dashboard-1.html" class="logo-collapsed">
							<img src="../static/images/logo-collapsed@2x.png" width="40" alt="" />
						</a>
					</div>
		
					<!-- This will toggle the mobile menu and will be visible only on mobile devices -->
					<div class="mobile-menu-toggle visible-xs">
						<a href="#" data-toggle="user-info-menu">
							<i class="fa-bell-o"></i>
							<span class="badge badge-success">7</span>
						</a>
		
						<a href="#" data-toggle="mobile-menu">
							<i class="fa-bars"></i>
						</a>
					</div>
		
					<!-- This will open the popup with user profile settings, you can use for any purpose, just be creative -->
					<div class="settings-icon">
						<a href="#" data-toggle="settings-pane" data-animate="true">
							<i class="linecons-cog"></i>
						</a>
					</div>
				</header>
				<ul id="main-menu" class="main-menu">
					<li>
						<a href="index.html">
							<i class="linecons-cog"></i>
							<span class="title">首页</span>
						</a>
					</li>
					<li class="opened">
						<a href="myBooks.html">
							<i class="linecons-desktop"></i>
							<span class="title">图书管理</span>
						</a>
						<ul>
							<li>
								<a href="addBook.html">新增图书</a>
							</li>
							<li class="active">
								<a href="editBook.html">编辑图书</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="shelf.html">
							<i class="linecons-note"></i>
							<span class="title">书架管理</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
		<div class="main-content">
			<nav class="navbar user-info-navbar"  role="navigation">
				<!-- Right links for user info navbar -->
				<ul class="user-info-menu right-links list-inline list-unstyled">
					<li class="dropdown user-profile">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img src="../static/images/user-4.png" alt="user-image" class="img-circle img-inline userpic-32" width="28" />
							<span>
								John Smith
								<i class="fa-angle-down"></i>
							</span>
						</a>
						<ul class="dropdown-menu user-profile-menu list-unstyled">
							<li class="last">
								<a href="extra-lockscreen.html">
									<i class="fa-lock"></i>
									Logout
								</a>
							</li>
						</ul>
					</li>
				</ul>
			</nav>
			<div class="panel panel-default panel-headerless">
				<div class="panel-body layout-variants">
					<form role="form" class="form-horizontal" id="bookInfo">
					</form>
				</div>
			</div>
			<div class="txt-center">
				<a href="index.html" class="ml15 btn btn-info">返回首页</a>
				<a class="btn btn-blue" id="btnsubmit">提交</a>
			</div>
		</div>
	</div>
	<!-- Page Loading Overlay -->
	<div class="page-loading-overlay">
		<div class="loader-2"></div>
	</div>
	<script id="bookTemplate" type="text/x-handlebars-template">
		<div class="form-group">
			<label class="col-sm-2 control-label" for="bookTitle">书名</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" disabled name="bookTitle" placeholder="请输入书的标题" value="{{bookTitle}}" data-require="1">
				<span class="help-block"></span>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label" for="bookTitle">标签</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" name="tags" placeholder="请输入书的标签" value="{{tags}}" data-require="1">
				<span class="help-block"></span>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label" for="bookTitle">作者</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" name="author" placeholder="请输入作者" value="{{author}}" data-require="1">
				<span class="help-block"></span>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label" for="bookTitle">作者简介</label>
			<div class="col-sm-10">
				<textarea class="form-control" name="authorIntro" rows="5" placeholder="请输入书的内容简介" data-require="0">{{authorIntro}}</textarea>
				<span class="help-block"></span>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label" for="bookTitle">内容简介</label>
			<div class="col-sm-10">
				<textarea class="form-control" name="summary" rows="8" placeholder="请输入书的内容简介" data-require="0">{{summary}}</textarea>
				<span class="help-block"></span>
			</div>
		</div>
	</script>
	<!-- Imported scripts on this page -->

	<script src="../static/asset/js/jquery-1.11.1.min.js"></script>
	<script src="../static/asset/js/handlebars.min.js"></script>
	<script src="../static/asset/js/resizeable.js"></script>
	<script src="../static/asset/js/joinable.js"></script>

	<script src="../static/asset/js/select2/select2.min.js"></script>
	<script src="../static/asset/js/jquery-ui/jquery-ui.min.js"></script>
	<script src="../static/asset/js/selectboxit/jquery.selectBoxIt.min.js"></script>
	<script src="../static/asset/js/multiselect/js/jquery.multi-select.js"></script>

	<script src="../static/asset/js/xenon-custom.js"></script>
	<script src="../static/asset/js/resizeable.js"></script>
	<script src="../static/asset/js/joinable.js"></script>
	<script src="../static/asset/js/select2/select2.min.js"></script>
	<script src="../static/asset/js/selectboxit/jquery.selectBoxIt.min.js"></script>
	<script src="../static/asset/js/multiselect/js/jquery.multi-select.js"></script>
	<script src="../static/asset/js/xenon-custom.js"></script>
	<script>
		$(document).ready(function ($) {
			var $bookInfo = $('#bookInfo');
			// 提交
			// 文本框失焦事件
			$bookInfo.find('[type="text"], textarea').blur(function (e) {
				var $el = $(this);
				var require = +$el.data('require');
				if (require === 1) {
					blur($el);
				}
			});
			// 下拉框
			$('select').change(function (e) {
				var $el = $(this);
				var name = $el.attr('name');
				var value = $el.val();
				$('[name="' + name + '"]').val(value);
				var require = +$el.data('require');
				if (require === 1) {
					blur($el);
				}
			});
			$('#btnsubmit').on('click', function (e) {
				var isPass = true;
				var data = {};
				$bookInfo.find('.form-control').each(function (e) {
					var $el = $(this);
					var require = +$el.data('require');
					var name = $el.attr('name');
					if (require === 1 && !validator($el)) {
						isPass = false;
					}
					else {
						!data[name] && (data[name] = $el.val());
					}
				});
				if (isPass) {
					submit(data);
				}
			});
			// 失焦事件
			function blur($el) {
				var $this = $el;
				var value = $.trim($this.val());
				var $parents = $this.parents('.form-group');
				if (!value) {
					$parents.addClass('has-error');
				}
				else {
					$parents.removeClass('has-error');
				}
			}
			// 验证表单
			function validator($el) {
				var value = $.trim($el.val());
				var isPass = false;
        		if (!value) {
	                var msg = '请输入' + $el.attr('placeholder');
	                $el.parents('.form-group').addClass('has-error')
	            }
	            else {
	                $el.parents('.form-group').removeClass('has-error')
	                isPass = true;
	            }
	            return isPass;
			}
			// 提交表单事件
			function submit(data) {
				$.ajax({
                    type: 'POST',
                    url: '/book/modifyBook', // 待修改
                    data: $.extend({bookId: $bookInfo.attr('data-id')},data),
                    dataType: 'json',
                    success: function (resp) {
                        if (+resp.code === 1) {
                            alert('编辑图书成功');
                        } else {
                        	alert(resp.msg);
                        }
                    }
                });
			}
			function getBookData() {
				$.ajax({
			        url: '/book/bookDetailData',
			        method: 'get',
			        data: {
			        	bookId: location.search.split('=')[1]
			        },
			        dataType: 'json',
			        success: function (resp) {
			            if (+resp.code === 1) {
							var bookTemplate = Handlebars.compile($("#bookTemplate").html());
							$bookInfo.attr('data-id', resp.data.bookId).html(bookTemplate(resp.data));
			            }
			        }
			    });
			}
			getBookData();
		});
	</script>
</body>
</html>